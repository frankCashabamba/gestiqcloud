<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ tenant_name }} â€” Dashboard Retail</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --font: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      --bg:#0f1115; --surface:#151922; --surface2:#1e2430; --text:#e6e8ee; --muted:#a7afc0; --border:#2a2f3a;
      --primary:#5B8CFF; --on-primary:#0b1020; --focus:#7aa2ff;
      --ok:#26d07c; --warn:#fbbf24; --err:#ff6b6b; --info:#38bdf8;
      --pad:12px; --gap:16px; --r:12px; --ctl:40px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:var(--font);line-height:1.45}
    .app{min-height:100dvh;display:grid;grid-template-columns:260px 1fr;grid-template-rows:56px 1fr;grid-template-areas:"topbar topbar" "sidebar main"}
    .top{grid-area:topbar;position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:12px;padding:0 var(--pad);background:var(--surface);border-bottom:1px solid var(--border)}
    .brand{display:flex;align-items:center;gap:10px;font-weight:600}
    .brand__logo{width:26px;height:26px;border-radius:8px;background:linear-gradient(135deg,var(--primary),#7aa2ff)}
    .search{flex:1;display:flex;align-items:center;gap:8px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;height:var(--ctl);padding:0 10px}
    .search input{border:0;background:transparent;color:var(--text);width:100%}
    .btn{height:var(--ctl);padding:0 12px;border-radius:10px;background:var(--surface);border:1px solid var(--border);color:var(--text);cursor:pointer}
    .btn--primary{background:var(--primary);color:var(--on-primary);border-color:transparent}
    .side{grid-area:sidebar;background:var(--surface);border-right:1px solid var(--border);padding:12px;position:sticky;top:56px;height:calc(100dvh - 56px)}
    .nav ul{list-style:none;margin:0;padding:0;display:grid;gap:6px}
    .nav a{display:block;padding:10px 12px;border-radius:10px;color:inherit;text-decoration:none}
    .nav a[aria-current="page"], .nav a:hover{background:var(--surface2)}
    .main{grid-area:main;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:var(--gap)}
    .col-12{grid-column:span 12}.col-8{grid-column:span 8}.col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-3{grid-column:span 3}
    @media (max-width:1100px){.grid{grid-template-columns:repeat(6,1fr)} .col-8{grid-column:span 6}.col-6{grid-column:span 6}.col-4{grid-column:span 3}}
    @media (max-width:800px){.grid{grid-template-columns:1fr} .side{display:none}}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:var(--pad);min-height:120px;display:flex;flex-direction:column;gap:8px;box-shadow:var(--shadow)}
    .card h3{margin:0 0 4px 0;font-size:16px}
    .kpis{display:flex;gap:12px;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:var(--muted)}
    .badge{padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:var(--muted)}
    .ok{color:var(--ok);border-color:color-mix(in srgb,var(--ok)40%,var(--border))}
    .warn{color:var(--warn);border-color:color-mix(in srgb,var(--warn)40%,var(--border))}
    .err{color:var(--err);border-color:color-mix(in srgb,var(--err)40%,var(--border))}
    .link{font-size:12px;padding:8px 10px;border:1px solid var(--border);border-radius:8px;color:var(--primary);text-decoration:none;background:var(--surface)}
    .list{display:grid;gap:8px}
    .list__item{display:flex;align-items:center;justify-content:space-between;border:1px dashed var(--border);border-radius:10px;padding:8px}
    .bar{height:8px;border-radius:6px;background:var(--surface2);overflow:hidden}
    .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--primary),#8db4ff)}
  </style>
</head>
<body>
  <div class="app">
    <header class="top">
      <div class="brand"><div class="brand__logo"></div><span>{{ tenant_name }}</span></div>
      <div class="search"><input placeholder="Buscar productos, clientes..." /></div>
      <button class="btn btn--primary" onclick="location.href='/pos'">ğŸ›’ POS</button>
    </header>

    <aside class="side">
      <nav class="nav">
        <ul>
          <li><a href="/dashboard" aria-current="page">ğŸ  Dashboard</a></li>
          <li><a href="/pos">ğŸ›’ POS</a></li>
          <li><a href="/ventas">ğŸ“Š Ventas</a></li>
          <li><a href="/inventario">ğŸ“¦ Inventario</a></li>
          <li><a href="/productos">ğŸ·ï¸ Productos</a></li>
          <li><a href="/clientes">ğŸ‘¥ Clientes</a></li>
          <li><a href="/proveedores">ğŸ­ Proveedores</a></li>
          <li><a href="/rrhh">ğŸ‘” RRHH</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main">
      <h1 style="margin:0 0 12px 0;font-size:20px">ğŸª Dashboard Retail</h1>
      <div class="grid">

        <!-- Ventas de hoy -->
        <section class="card col-4">
          <h3>ğŸ’° Ventas de Hoy</h3>
          <div class="kpis">
            <span class="pill">Tickets: {{ today_tickets }}</span>
            <span class="pill">Total: {{ today_sales }}</span>
            <span class="badge {% if vs_yesterday > 0 %}ok{% else %}err{% endif %}">{{ vs_yesterday }}% vs ayer</span>
          </div>
        </section>

        <!-- Ticket medio -->
        <section class="card col-4">
          <h3>ğŸ“ˆ Ticket Medio</h3>
          <div class="kpis">
            <span class="pill">Hoy: {{ avg_ticket_today }}</span>
            <span class="pill">Mes: {{ avg_ticket_month }}</span>
            <span class="badge ok">Meta: {{ target_ticket }}</span>
          </div>
        </section>

        <!-- MÃ©todos de pago -->
        <section class="card col-4">
          <h3>ğŸ’³ Formas de Pago (Hoy)</h3>
          <div class="list">
            <div class="list__item"><span>Efectivo</span><strong>{{ cash_sales }}</strong></div>
            <div class="list__item"><span>Tarjeta</span><strong>{{ card_sales }}</strong></div>
            <div class="list__item"><span>Transferencia</span><strong>{{ transfer_sales }}</strong></div>
          </div>
        </section>

        <!-- Top productos -->
        <section class="card col-6">
          <h3>ğŸ”¥ Productos MÃ¡s Vendidos</h3>
          <div class="list">
            {% for product in top_products %}
            <div class="list__item">
              <div style="flex:1">
                <strong>{{ product.name }}</strong>
                <div class="bar"><i style="width:{{ product.percentage }}%"></i></div>
              </div>
              <span>{{ product.qty }} uds</span>
            </div>
            {% endfor %}
          </div>
        </section>

        <!-- CategorÃ­as mÃ¡s vendidas -->
        <section class="card col-6">
          <h3>ğŸ“‚ CategorÃ­as MÃ¡s Vendidas</h3>
          <div class="list">
            {% for category in top_categories %}
            <div class="list__item">
              <span>{{ category.name }}</span>
              <strong>{{ category.sales }}</strong>
            </div>
            {% endfor %}
          </div>
        </section>

        <!-- Stock bajo -->
        <section class="card col-6">
          <h3>âš ï¸ Stock Bajo (< Punto de Reorden)</h3>
          <div class="list">
            {% for item in low_stock %}
            <div class="list__item">
              <span>{{ item.product_name }}</span>
              <span class="badge warn">Stock: {{ item.qty }}</span>
            </div>
            {% endfor %}
          </div>
          <a class="link" href="/inventario?filter=low_stock">Ver todos</a>
        </section>

        <!-- Empleados activos -->
        <section class="card col-6">
          <h3>ğŸ‘” Empleados de Hoy</h3>
          <div class="list">
            {% for employee in active_employees %}
            <div class="list__item">
              <span>{{ employee.name }}</span>
              <span class="badge ok">{{ employee.sales_count }} ventas</span>
            </div>
            {% endfor %}
          </div>
        </section>

        <!-- Devoluciones -->
        <section class="card col-12">
          <h3>ğŸ”„ Devoluciones del DÃ­a</h3>
          <div class="kpis">
            <span class="pill">Cantidad: {{ returns_count }}</span>
            <span class="pill">Valor: {{ returns_value }}</span>
            <span class="badge {% if returns_percentage > 2 %}warn{% else %}ok{% endif %}">{{ returns_percentage }}% del total</span>
          </div>
          <div class="list">
            {% for return_item in recent_returns %}
            <div class="list__item">
              <span>{{ return_item.product_name }} - {{ return_item.reason }}</span>
              <strong>{{ return_item.amount }}</strong>
            </div>
            {% endfor %}
          </div>
        </section>

      </div>
    </main>
  </div>
</body>
</html>
