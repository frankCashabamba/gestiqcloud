<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel de Administraci√≥n</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --brand:#2563eb;
      --brand-600:#1d4ed8;
      --border:#e2e8f0;
      --rose:#e11d48;
      --rose-50:#fff1f2;
      --ok:#16a34a;
      --shadow:0 6px 20px rgba(15,23,42,.08);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font:14px/1.45 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    a{text-decoration:none;color:inherit}
    .container{max-width:1120px;margin:0 auto;padding:28px 20px}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px}
    .title{font-size:28px;font-weight:700;margin:0}
    .subtitle{margin:6px 0 0;color:var(--muted)}
    .btn{
      appearance:none;border:1px solid var(--border);background:#fff;
      color:#0f172a;border-radius:10px;padding:10px 14px;font-weight:600;
      display:inline-flex;gap:10px;align-items:center;cursor:pointer;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
      transition:transform .06s ease, background .15s ease, box-shadow .15s ease;
    }
    .btn:hover{background:#f8fafc}
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn-primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn-primary:hover{background:var(--brand-600)}
    .btn-ghost{background:#fff}
    .grid{display:grid;gap:16px}
    .metrics{grid-template-columns:repeat(4,minmax(0,1fr));}
    @media (max-width: 900px){ .metrics{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (max-width: 540px){ .metrics{grid-template-columns:1fr;} }
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
      padding:16px;box-shadow:var(--shadow);
    }
    .stat-label{font-size:12px;color:var(--muted);margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
    .stat-value{font-size:24px;font-weight:700}
    .trend{font-size:11px;border-radius:999px;padding:2px 8px;border:1px solid #bbf7d0;background:#f0fdf4;color:#14532d}
    .modules{grid-template-columns:repeat(3,minmax(0,1fr));}
    @media (max-width: 900px){ .modules{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (max-width: 540px){ .modules{grid-template-columns:1fr;} }
    .module-card{
      background:#fff;border:1px solid var(--border);border-radius:16px;
      padding:16px;box-shadow:var(--shadow);transition:transform .08s ease, box-shadow .15s ease;
    }
    .module-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(15,23,42,.10)}
    .module-title{font-weight:600;margin:0 0 4px}
    .module-desc{margin:0;color:var(--muted);font-size:13px}
    .module-head{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .icon{
      width:34px;height:34px;display:inline-flex;align-items:center;justify-content:center;
      border-radius:10px;background:#eef2ff;border:1px solid #e0e7ff;
    }
    .section-title{margin:26px 0 12px;font-size:18px;font-weight:600}
    .panel{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width: 960px){ .panel{grid-template-columns:1fr} }
    .chart-card{height:300px}
    /* tabla */
    .table-wrap{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:#fff;box-shadow:var(--shadow)}
    table{width:100%;border-collapse:separate;border-spacing:0;font-size:13.5px}
    thead th{
      position:sticky;top:0;background:#f8fafc;border-bottom:1px solid var(--border);
      text-align:left;padding:12px 14px;color:#334155;font-weight:600;z-index:1
    }
    tbody td{padding:12px 14px;border-bottom:1px solid var(--border);vertical-align:middle}
    tbody tr:nth-child(even){background:#fafbff}
    tbody tr:hover{background:#f1f5ff}
    .id{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px}
    .row-actions{display:flex;justify-content:flex-end;gap:8px}
    .menu{position:relative}
    .menu-btn{
      width:38px;height:38px;border-radius:10px;border:1px solid var(--border);background:#fff;
      display:inline-flex;align-items:center;justify-content:center;cursor:pointer;
    }
    .menu-items{
      position:absolute;right:0;top:42px;background:#fff;border:1px solid var(--border);
      border-radius:12px;box-shadow:var(--shadow);min-width:210px;padding:6px;display:none;z-index:10
    }
    .menu.open .menu-items{display:block}
    .menu-item{display:block;width:100%;text-align:left;border:0;background:transparent;padding:8px 10px;border-radius:8px;cursor:pointer}
    .menu-item:hover{background:#f8fafc}
    .menu-item.danger{color:var(--rose)}
    .badge{display:inline-flex;align-items:center;border:1px solid var(--border);background:#f8fafc;color:#334155;border-radius:999px;padding:3px 8px;font-size:11px}
    .cell-stack{display:flex;flex-direction:column;gap:4px}
    .muted{color:var(--muted)}
    .cta-open{white-space:nowrap}
    footer{margin:28px 0;color:#94a3b8;font-size:12px}
    .legend{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:12px;margin-top:6px}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--brand)}
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div>
        <h1 class="title">Panel de Administraci√≥n</h1>
        <p class="subtitle">Visi√≥n general del sistema y accesos r√°pidos.</p>
      </div>
      <button id="refresh" class="btn btn-ghost" aria-label="Actualizar m√©tricas">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0114.13-3.36L23 10"></path><path d="M20.49 15a9 9 0 01-14.13 3.36L1 14"></path>
        </svg>
        Actualizar
      </button>
    </header>

    <!-- M√âTRICAS al estilo de tu TSX -->
    <section class="grid metrics" aria-label="M√©tricas del sistema">
      <div class="card">
        <div class="stat-label">Tenants Activos <span class="trend">+4 esta semana</span></div>
        <div class="stat-value" id="m-tenants-activos">‚Äî</div>
        <div class="muted" id="m-tenants-total">‚Äî total</div>
      </div>
      <div class="card">
        <div class="stat-label">Usuarios Totales</div>
        <div class="stat-value" id="m-usuarios-total">‚Äî</div>
        <div class="muted" id="m-usuarios-activos">‚Äî activos</div>
      </div>
      <div class="card">
        <div class="stat-label">M√≥dulos Activos</div>
        <div class="stat-value" id="m-modulos-activos">‚Äî</div>
        <div class="muted" id="m-modulos-total">‚Äî disponibles</div>
      </div>
      <div class="card">
        <div class="stat-label">Migraciones</div>
        <div class="stat-value" id="m-migraciones-ok">‚Äî</div>
        <div class="muted" id="m-migraciones-pend">‚Äî pendientes</div>
      </div>
    </section>

    <!-- PANEL: gr√°fico + √∫ltimos tenants -->
    <section class="panel">
      <div class="card chart-card">
        <h3 style="margin:0 0 8px;font-size:16px">Nuevos Tenants (30 d√≠as)</h3>
        <canvas id="chart" height="220" style="width:100%"></canvas>
        <div class="legend"><span class="dot"></span> Nuevos tenants</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px;font-size:16px">√öltimos Tenants Creados</h3>
        <div class="table-wrap">
          <table id="tabla">
            <thead>
              <tr>
                <th>Tenant</th>
                <th>Slug</th>
                <th>Fecha</th>
                <th style="text-align:right">Acciones</th>
              </tr>
            </thead>
            <tbody id="tbody-tenants">
              <!-- se llena por JS -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- M√ìDULOS (respeta tus nombres y descripciones) -->
    <h2 class="section-title">Accesos a m√≥dulos</h2>
    <section class="grid modules">
      <a href="/admin/empresas" class="module-card" aria-label="Empresas">
        <div class="module-head">
          <span class="icon">üè¢</span>
          <h3 class="module-title">Empresas</h3>
        </div>
        <p class="module-desc">Gesti√≥n de empresas registradas.</p>
      </a>

      <a href="/admin/usuarios" class="module-card" aria-label="Usuarios">
        <div class="module-head">
          <span class="icon">üë•</span>
          <h3 class="module-title">Usuarios</h3>
        </div>
        <p class="module-desc">Control de usuarios del sistema.</p>
      </a>

      <a href="/admin/logs" class="module-card" aria-label="Logs del Sistema">
        <div class="module-head">
          <span class="icon">üìú</span>
          <h3 class="module-title">Logs del Sistema</h3>
        </div>
        <p class="module-desc">Auditor√≠a y monitoreo centralizado.</p>
      </a>

      <a href="/admin/incidencias" class="module-card" aria-label="Incidencias">
        <div class="module-head">
          <span class="icon">üõ†Ô∏è</span>
          <h3 class="module-title">Incidencias</h3>
        </div>
        <p class="module-desc">ü§ñ Con IA auto-resoluci√≥n.</p>
      </a>

      <a href="/admin/configuracion" class="module-card" aria-label="Configuraci√≥n de sistemas">
        <div class="module-head">
          <span class="icon">‚öôÔ∏è</span>
          <h3 class="module-title">Configuraci√≥n de sistemas</h3>
        </div>
        <p class="module-desc">S√≥lo las configuraciones del sistema.</p>
      </a>

      <a href="/admin/ops/migraciones" class="module-card" aria-label="Migraciones">
        <div class="module-head">
          <span class="icon">‚¨ÜÔ∏è</span>
          <h3 class="module-title">Migraciones</h3>
        </div>
        <p class="module-desc">Ejecutar migraciones (Render Job).</p>
      </a>
    </section>

    <!-- M√≥dulos del sistema activos (caps) -->
    <h2 class="section-title">üì¶ M√≥dulos del sistema activos</h2>
    <div class="card">
      <div id="caps" style="display:flex;flex-wrap:wrap;gap:8px"></div>
    </div>

    <footer>v1.0 ‚Ä¢ demo visual cercana a tu AdminPanel.tsx</footer>
  </div>

  <script>
    // ===== MOCKS QUE EMULAN TU HOOK useAdminStats =====
    const stats = {
      tenants_activos: 12, tenants_total: 18,
      usuarios_total: 240, usuarios_activos: 51,
      modulos_activos: 9, modulos_total: 14,
      migraciones_aplicadas: 128, migraciones_pendientes: 0,
      tenants_por_dia: Array.from({length:30}, (_,i)=>({fecha:i, cantidad: Math.max(0, Math.round(5 + 3*Math.sin(i/4) + (Math.random()*2-1)))})),
      ultimos_tenants: [
        {id:1, nombre:"Bazar OMAR", slug:"bazar-omar", created_at:"2025-02-01T10:10:00Z"},
        {id:2, nombre:"kusi panaderia", slug:"kusi-panaderia", created_at:"2025-01-28T13:22:00Z"},
        {id:3, nombre:"demo empresa", slug:"demo-empresa", created_at:"2025-01-20T09:00:00Z"}
      ],
      modulos_sistema_activos: ["ventas","compras","cajas","clientes","proveedores","inventario","reportes","api","pwa"]
    };

    // ===== PINTAR M√âTRICAS =====
    const $ = (id)=>document.getElementById(id);
    $('m-tenants-activos').textContent = stats.tenants_activos;
    $('m-tenants-total').textContent   = `${stats.tenants_total} total`;
    $('m-usuarios-total').textContent  = stats.usuarios_total;
    $('m-usuarios-activos').textContent= `${stats.usuarios_activos} activos`;
    $('m-modulos-activos').textContent = stats.modulos_activos;
    $('m-modulos-total').textContent   = `${stats.modulos_total} disponibles`;
    $('m-migraciones-ok').textContent  = stats.migraciones_aplicadas;
    $('m-migraciones-pend').textContent= stats.migraciones_pendientes ? `${stats.migraciones_pendientes} pendientes` : 'Actualizado ‚úì';

    // ===== TABLA DE √öLTIMOS TENANTS =====
    const tbody = document.getElementById('tbody-tenants');
    const fmt = (d)=> new Date(d).toLocaleString('es-ES',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'});
    stats.ultimos_tenants.forEach(t=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="cell-stack"><strong>${t.nombre}</strong></td>
        <td><span class="badge">${t.slug ?? '‚Äî'}</span></td>
        <td>${fmt(t.created_at)}</td>
        <td>
          <div class="row-actions">
            <a href="/admin/empresas/${t.id}/editar" class="btn btn-ghost">Editar</a>
            <div class="menu">
              <button class="menu-btn">‚ãÆ</button>
              <div class="menu-items">
                <button class="menu-item">üë• Usuarios</button>
                <button class="menu-item">üì¶ M√≥dulos</button>
                <button class="menu-item">‚öôÔ∏è Configuraci√≥n</button>
                <button class="menu-item danger">üóëÔ∏è Eliminar</button>
              </div>
            </div>
          </div>
        </td>`;
      tbody.appendChild(tr);
    });

    // ===== CAPS DE M√ìDULOS ACTIVOS =====
    const caps = document.getElementById('caps');
    stats.modulos_sistema_activos.forEach(m=>{
      const s = document.createElement('span');
      s.className = 'badge'; s.textContent = m;
      caps.appendChild(s);
    });

    // ===== CHART muy ligero en canvas (sin librer√≠as) =====
    (function drawChart(){
      const canvas = document.getElementById('chart'); const ctx = canvas.getContext('2d');
      const w = canvas.width = canvas.clientWidth; const h = canvas.height;
      ctx.clearRect(0,0,w,h);
      const padding = 28;
      const data = stats.tenants_por_dia;
      const max = Math.max(...data.map(d=>d.cantidad), 10);
      const stepX = (w - padding*2) / (data.length-1);
      const y = (v)=> h - padding - (v/max)*(h - padding*2);
      // grid
      ctx.strokeStyle = '#e5e7eb'; ctx.lineWidth = 1;
      for(let i=0;i<=4;i++){ const gy = y(max*i/4); ctx.beginPath(); ctx.moveTo(padding, gy); ctx.lineTo(w-padding, gy); ctx.stroke(); }
      // area
      ctx.beginPath();
      data.forEach((d,i)=>{
        const px = padding + i*stepX, py = y(d.cantidad);
        if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
      });
      ctx.lineTo(w-padding,h-padding); ctx.lineTo(padding,h-padding); ctx.closePath();
      ctx.fillStyle = 'rgba(37,99,235,.12)'; ctx.fill();
      // line
      ctx.beginPath();
      data.forEach((d,i)=>{ const px = padding + i*stepX, py = y(d.cantidad); if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py); });
      ctx.strokeStyle = 'rgba(37,99,235,1)'; ctx.lineWidth = 2; ctx.stroke();
    })();

    // ===== MEN√ö ‚ãÆ =====
    const closeAllMenus = () => document.querySelectorAll('.menu.open').forEach(m => m.classList.remove('open'));
    document.addEventListener('click', (e) => {
      const btn = (e.target).closest?.('.menu-btn');
      if (btn) {
        const menu = btn.parentElement;
        const open = menu.classList.contains('open');
        closeAllMenus();
        if (!open) menu.classList.add('open');
      } else if (!(e.target).closest?.('.menu-items')) {
        closeAllMenus();
      }
    });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeAllMenus(); });

    // ===== REFRESH DEMO =====
    document.getElementById('refresh').addEventListener('click', (e) => {
      const b = e.currentTarget;
      b.disabled = true; b.innerHTML = '‚è≥ Actualizando‚Ä¶';
      setTimeout(() => { b.disabled = false; b.innerHTML = 'üîÑ Actualizar'; }, 700);
    });
  </script>
</body>
</html>
