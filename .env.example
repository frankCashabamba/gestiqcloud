# ============================================================================
# GESTIQCLOUD UNIFIED ENVIRONMENT CONFIGURATION - EXAMPLE
# ============================================================================
# INSTRUCTIONS:
# 1. Copy this file to .env in the repository root
# 2. Edit .env with YOUR actual values
# 3. Never commit .env with real secrets
# 4. Use git-secret or 1Password for production secrets
#
# This is the SINGLE source of truth for all environments
#
# Override-by-environment:
# - Development: Use as-is locally, or set ENVIRONMENT=development
# - Staging: Copy to server and set ENVIRONMENT=staging
# - Production: Copy to server and set ENVIRONMENT=production
#
# System env vars take precedence over file values
# Example: ENVIRONMENT=production ./app will override file ENVIRONMENT
# ============================================================================

# ============================================================================
# CORE ENVIRONMENT
# ============================================================================
# Options: development, staging, production
ENVIRONMENT=development

# ============================================================================
# BACKEND - DATABASE
# ============================================================================
# PostgreSQL connection string (REQUIRED)
# Format: postgresql://user:password@host:port/database
# For SQLite (dev only): sqlite:///./gestiqcloud.db
DATABASE_URL=postgresql://gestiqcloud:password@localhost:5432/gestiqcloud

# Development fallback (ONLY used if DATABASE_URL is not set)
# DEV_DATABASE_URL=postgresql://postgres:root@localhost:5432/gestiqcloud_dev

# Connection pool settings
POOL_SIZE=5
MAX_OVERFLOW=10
POOL_TIMEOUT=10
DB_STATEMENT_TIMEOUT_MS=15000

# ============================================================================
# BACKEND - SECURITY (CRITICAL)
# ============================================================================
# Secret keys for signing (required in production, auto-generated in dev)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=your-secret-key-min-32-chars-change-in-production
JWT_SECRET_KEY=your-jwt-secret-key-min-32-chars-change-in-production

# JWT Configuration
JWT_ALGORITHM=HS256
JWT_ISSUER=gestiqcloud
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=30

# CORS Origins (REQUIRED in production - NO localhost allowed)
# Format: comma-separated list of full URLs
# Development: http://localhost:5173,http://localhost:5174,http://localhost:8081,http://localhost:8082
# Production: https://www.gestiqcloud.com,https://admin.gestiqcloud.com
CORS_ORIGINS=http://localhost:5173,http://localhost:5174,http://localhost:8081,http://localhost:8082

# Cookies
SESSION_COOKIE_NAME=bff_session
CSRF_COOKIE_NAME=csrf_token
COOKIE_DOMAIN=localhost
COOKIE_SECURE=false
# In production: COOKIE_DOMAIN=.gestiqcloud.com, COOKIE_SECURE=true

# ============================================================================
# BACKEND - EMAIL / SMTP (REQUIRED in production)
# ============================================================================
# Gmail example:
#   EMAIL_HOST=smtp.gmail.com
#   EMAIL_HOST_USER=your-email@gmail.com
#   Generate app password: https://myaccount.google.com/apppasswords
#
# Custom SMTP:
#   EMAIL_HOST=mail.example.com
#   EMAIL_HOST_USER=username
#   EMAIL_HOST_PASSWORD=password
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=true
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# From email address (REQUIRED in production - e.g., noreply@gestiqcloud.com)
# Must be a valid email that SMTP server allows
# If email sending fails, this is usually the problem
DEFAULT_FROM_EMAIL=noreply@gestiqcloud.com

# Password reset link
PASSWORD_RESET_URL_BASE=http://localhost:8082/reset-password
# Production: PASSWORD_RESET_URL_BASE=https://www.gestiqcloud.com/reset-password

# ============================================================================
# BACKEND - REDIS (OPTIONAL - for caching and Celery)
# ============================================================================
# If not set, caching is disabled (safe for development)
# Production should use external Redis (AWS ElastiCache, DigitalOcean, etc.)
#
# Local Redis:
#   REDIS_URL=redis://localhost:6379/0
#
# AWS ElastiCache (TLS):
#   REDIS_URL=rediss://your-endpoint.ng.0001.use1.cache.amazonaws.com:6379/0
#
# DigitalOcean:
#   REDIS_URL=rediss://:password@host:port/0
REDIS_URL=redis://localhost:6379/0
REDIS_RESULT_URL=redis://localhost:6379/1

# Development fallback (ONLY used if REDIS_URL is not set)
# DEV_REDIS_URL=redis://localhost:6379/0

# ============================================================================
# BACKEND - E-INVOICING CERTIFICATES
# ============================================================================
# Format: CERT_PASSWORD_<TENANT_SLUG>_<COUNTRY_CODE>
# Example for tenant "acme-corp" in Ecuador (ECU):
#
# CERT_PASSWORD_acme-corp_ECU=your-cert-password-here
# CERT_PASSWORD_acme-corp_ESP=your-cert-password-here
#
# Add more as needed for each tenant/country combination
# WARNING: Never commit with real passwords. Use AWS Secrets Manager in production.
#
# Production with AWS Secrets Manager (recommended):
# - Store secrets in AWS Secrets Manager
# - Use IAM roles to grant access
# - Rotate secrets regularly
CERT_PASSWORD_acme-corp_ECU=your-cert-password-here
CERT_PASSWORD_acme-corp_ESP=your-cert-password-here

# AWS Configuration (if using AWS Secrets Manager)
# AWS credentials are typically handled by IAM roles in production
AWS_REGION=us-east-1

# ============================================================================
# BACKEND - AI / DOCUMENT CLASSIFICATION
# ============================================================================
# Provider options: local, ollama, openai, azure, ovhcloud
#
# DEVELOPMENT RECOMMENDED: ollama (local LLM, free, no internet)
# PRODUCTION RECOMMENDED: ovhcloud (managed API, gpt-4o quality)
#
# Comparison:
#   local     = Rule-based heuristics, ~75% accuracy, 0 cost, offline
#   ollama    = Local LLM (llama3.1:8b), ~85% accuracy, 0 cost, offline
#   openai    = GPT-3.5/4, 95%+ accuracy, ~$0.0015/request
#   azure     = Azure OpenAI, 95%+ accuracy, variable cost
#   ovhcloud  = OVHCloud AI, 95%+ accuracy, ~$0.005-0.015/request

# ============================================================================
# OPTION 1: DEVELOPMENT with Ollama (RECOMMENDED)
# ============================================================================
AI_PROVIDER=ollama
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama3.1:8b
OLLAMA_TIMEOUT=30

# ============================================================================
# OPTION 2: PRODUCTION with OVHCloud (RECOMMENDED)
# ============================================================================
# AI_PROVIDER=ovhcloud
# OVHCLOUD_API_KEY=your-api-key-here
# OVHCLOUD_API_SECRET=your-api-secret-here
# OVHCLOUD_BASE_URL=https://manager.eu.ovhcloud.com/api/v2
# OVHCLOUD_MODEL=gpt-4o
# OVHCLOUD_TIMEOUT=60

# ============================================================================
# OPTION 3: OpenAI (Alternative for production)
# ============================================================================
# AI_PROVIDER=openai
# OPENAI_API_KEY=sk-...
# OPENAI_BASE_URL=https://api.openai.com/v1
# OPENAI_MODEL=gpt-3.5-turbo  # or gpt-4o for better quality

# ============================================================================
# OPTION 4: Azure OpenAI (Alternative for production)
# ============================================================================
# AI_PROVIDER=azure
# AZURE_OPENAI_KEY=your-key
# AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com

# ============================================================================
# OPTION 5: Local heuristics (Fallback, no LLM)
# ============================================================================
# AI_PROVIDER=local
# Uses pattern matching, 75% accuracy, completely offline

# ============================================================================
# AI Common Settings (applies to all providers)
# ============================================================================
IMPORT_AI_CONFIDENCE_THRESHOLD=0.7
IMPORT_AI_CACHE_ENABLED=true
IMPORT_AI_CACHE_TTL=86400
IMPORT_AI_LOG_TELEMETRY=true
IMPORT_CONFIRMATION_THRESHOLD=0.7

# ============================================================================
# BACKEND - ERROR TRACKING (SENTRY)
# ============================================================================
# Sentry error tracking (optional - disabled if DSN not set)
# Get your DSN from: https://sentry.io/settings/<org>/projects/<project>/keys/
# SENTRY_DSN=https://xxxx@o12345.ingest.sentry.io/67890
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1

# ============================================================================
# BACKEND - GENERAL
# ============================================================================
FRONTEND_URL=http://localhost:5173
LOG_LEVEL=INFO
APP_VERSION=0.1.0

# Uploads
UPLOADS_DIR=uploads
MAX_REQUEST_BYTES=5242880
GZIP_ENABLED=true

# ============================================================================
# FRONTEND - TENANT APP
# ============================================================================
# Vite build variables (prefixed with VITE_)
# These are injected at build time, not runtime
#
# API Configuration
VITE_API_URL=http://localhost:8000
VITE_API_SUFFIX=/api/v1
VITE_SUPPORTED_LANGS=en,es
VITE_TENANT_ORIGIN=http://localhost:8082
VITE_ADMIN_ORIGIN=http://localhost:8081

# ElectricSQL (offline-first sync - EXPERIMENTAL)
# Set to "1" to enable ElectricSQL sync
# If enabled, VITE_ELECTRIC_URL is REQUIRED
#
# Development with local ElectricSQL:
#   VITE_ELECTRIC_ENABLED=1
#   VITE_ELECTRIC_URL=ws://localhost:5133
#
# Production: Only enable if ElectricSQL is properly deployed
VITE_ELECTRIC_ENABLED=0
VITE_ELECTRIC_URL=ws://localhost:5133

# Build configuration
VITE_BASE_PATH=/
VITE_BUILD_ID=dev

# ============================================================================
# FRONTEND - ADMIN APP
# ============================================================================
# Uses same VITE_API_URL, VITE_API_SUFFIX as tenant
# Admin-specific origins
VITE_ADMIN_ORIGIN=http://localhost:8081
VITE_TENANT_ORIGIN=http://localhost:8082

# ============================================================================
# CLOUDFLARE WORKER - EDGE GATEWAY
# ============================================================================
# These control the edge proxy (if deployed to Cloudflare)
# In production, set via Cloudflare Dashboard (DO NOT commit secrets here)
#
# IMPORTANT: In production, configure via Cloudflare Dashboard UI, not here
# Reasons:
#   1. Secrets should not be in version control
#   2. Different routes per subdomain (api.gestiqcloud.com, admin.gestiqcloud.com, etc.)
#   3. Deployment automation can set these via wrangler secrets command

# Target API backend (REQUIRED)
# Development: http://localhost:8000
# Staging: https://api-staging.example.com
# Production: https://api.example.com (set in Cloudflare Dashboard)
TARGET=http://localhost:8000

# Allowed origins for CORS at the edge (REQUIRED in production)
# Development: http://localhost:5173,http://localhost:8081,http://localhost:8082
# Staging: https://admin-staging.example.com,https://app-staging.example.com
# Production: https://www.gestiqcloud.com,https://admin.gestiqcloud.com (set in Cloudflare Dashboard)
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:8081,http://localhost:8082

# Cookie domain for rewriting at edge
COOKIE_DOMAIN=localhost
# Staging: COOKIE_DOMAIN=.example.com
# Production: COOKIE_DOMAIN=.gestiqcloud.com (set in Cloudflare Dashboard)

# HSTS enforcement at edge (0 = disabled, 1 = enabled)
HSTS_ENABLED=0
# Production: HSTS_ENABLED=1 (set in Cloudflare Dashboard)

# API version for informational purposes
API_VERSION=1.0.0-dev

# Telegram API base (optional override)
# TELEGRAM_API_BASE=https://api.telegram.org

# ============================================================================
# INFRASTRUCTURE / DOCKER
# ============================================================================
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1

# ============================================================================
# LEGACY DEPRECATION (if applicable)
# ============================================================================
LEGACY_SUNSET=Wed, 31 Dec 2025 00:00:00 GMT
LEGACY_DEPRECATION_LINK=https://docs.example.com/changelog#legacy

# ============================================================================
# DEPLOYMENT NOTES
# ============================================================================
#
# DEVELOPMENT:
# 1. Copy this file to .env
# 2. Edit with localhost values
# 3. Run: python -m uvicorn apps.backend.app.main:app --reload
# 4. Frontend should connect to http://localhost:8000
#
# STAGING:
# 1. Copy this file to .env on staging server
# 2. Edit with staging values (e.g., api-staging.example.com)
# 3. Set: ENVIRONMENT=staging
# 4. Deploy backend and frontends
# 5. Test end-to-end
#
# PRODUCTION:
# 1. DO NOT copy secrets into .env
# 2. Use environment management:
#    - Render.com: Set via Dashboard environment variables
#    - Docker: Pass via --env-file or docker-compose
#    - Kubernetes: Use ConfigMap + Secrets
#    - Heroku: Use `heroku config:set KEY=value`
# 3. Set: ENVIRONMENT=production (system env, not in .env)
# 4. Validate: Check logs for "[settings]" startup messages
# 5. Certific management: Use AWS Secrets Manager or similar
#
# ============================================================================
IMPORTS_TESSERACT_CMD=C:\Program Files\Tesseract-OCR\tesseract.exe
IMPORTS_OCR_LANG=spa+eng
IMPORTS_TESSERACT_ENABLED=1
IMPORTS_EASYOCR_ENABLED=1

# ============================================================================
# Upload storage mode
# ============================================================================
# Disable local on-disk storage (chunk uploads, attachments). Useful if you only want
# to persist audit metadata + extracted JSON, without keeping original files.
IMPORTS_STORE_UPLOAD_FILES=1

# When 0: OCR /imports/process runs inline and stores only filename + extracted JSON in DB
# (no file bytes in DB/uploads). When 1: stores payload bytes in import_ocr_jobs for async workers.
IMPORTS_OCR_STORE_PAYLOAD=1
